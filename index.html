<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <title>安全访问页面</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #f8f9fa;
    }

    /* 高端加载动画 */
    .loading-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 5px solid #e3f2fd;
      border-top: 5px solid #2196f3;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    .loading-text {
      color: #2d3748;
      font-size: 16px;
      font-weight: 500;
      position: relative;
    }
    .loading-text::after {
      content: '';
      animation: dots 1.5s infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes dots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
      100% { content: ''; }
    }

    /* 未授权提示框 - 高端样式 + 动态效果 */
    .auth-tip-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      padding: 15px 20px;
      box-shadow: 0 -4px 20px rgba(255, 107, 107, 0.3);
      z-index: 9998;
      display: none;
      animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }
    @keyframes slideUp {
      0% { transform: translateY(100%); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .auth-tip-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 100%;
    }
    .auth-tip-text {
      color: #ffffff;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.5;
      flex: 1;
      margin-right: 15px;
    }
    .auth-btn {
      background: #ffffff;
      color: #ff6b6b;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }
    .auth-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      background: #f8f9fa;
    }

    /* iframe样式（适配提示框高度） */
    #target-iframe {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      display: none;
      z-index: 1;
      transition: height 0.5s ease;
    }
    #target-iframe.with-tip {
      height: calc(100% - 70px); /* 给提示框留空间 */
    }

    /* 错误提示页 */
    .error-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #e8f4f8 0%, #f0f8fb 100%);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9998;
    }
    .error-icon {
      font-size: 60px;
      color: #ff6b6b;
      margin-bottom: 20px;
    }
    .error-text {
      color: #2d3748;
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 10px;
    }
    .error-desc {
      color: #718096;
      font-size: 14px;
      text-align: center;
      padding: 0 20px;
    }
  </style>
  <!-- 引入字体图标（用于错误提示） -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- 加载页面 -->
  <div class="loading-container" id="loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">安全验证中</div>
  </div>

  <!-- 错误提示页 -->
  <div class="error-page" id="errorPage">
    <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
    <div class="error-text">链接加载失败</div>
    <div class="error-desc" id="errorDesc">请检查链接是否有效或稍后重试</div>
  </div>

  <!-- 未授权提示框 -->
  <div class="auth-tip-bar" id="authTipBar">
    <div class="auth-tip-content">
      <div class="auth-tip-text" id="authTipText">提示：该域名未授权，如需去除提示请联系管理员授权</div>
      <button class="auth-btn" id="authBtn">立即授权</button>
    </div>
  </div>

  <!-- 嵌套目标链接的iframe -->
  <iframe id="target-iframe"></iframe>

  <script>
    // ========== 小白可修改的配置区 ==========
    // 1. 白名单域名（只允许这些域名的链接被展示）
    const ALLOWED_DOMAINS = [
      'xffwz.com',
      'xffuw.com',
      'yaowei.xyz',
      '947p.cn',
      '836k.cn',
      'ychy2.cn',
      'qihangct888.com',
      'srgg.7tjmctp7.my'
      // 新增域名格式：'xxx.com'，加逗号分隔
    ];
    // 2. 未授权提示框内容
    const AUTH_TIP_TEXT = '提示：该域名未授权，如需去除底部提示请联系小富富VX：zhengfuzhi88授权';
    // 3. 授权按钮跳转链接
    const AUTH_BTN_URL = 'https://work.weixin.qq.com/kfid/kfc27858adae0e592cf';
    // 4. 未授权时的页面标题
    const UNAUTH_TITLE = '小富富网络防红系统-未授权';
    // 5. 加载失败提示语
    const LOAD_ERROR_TEXT = '链接加载失败，请检查链接是否有效或联系管理员';
    // ========== 配置区结束 ==========

    // 元素获取
    const loading = document.getElementById('loading');
    const errorPage = document.getElementById('errorPage');
    const errorDesc = document.getElementById('errorDesc');
    const authTipBar = document.getElementById('authTipBar');
    const authTipText = document.getElementById('authTipText');
    const authBtn = document.getElementById('authBtn');
    const iframe = document.getElementById('target-iframe');

    // 设置提示框内容和按钮链接
    authTipText.textContent = AUTH_TIP_TEXT;
    authBtn.addEventListener('click', () => {
      window.open(AUTH_BTN_URL, '_blank');
    });

    // 解析URL参数里的目标链接（base64解码）
    function getTargetUrl() {
      const params = new URLSearchParams(window.location.search);
      const encodedUrl = params.get('c');
      if (!encodedUrl) return null;

      // base64解码（兼容特殊字符）
      try {
        return decodeURIComponent(atob(encodedUrl));
      } catch (e) {
        console.log('链接解码失败：', e);
        return null;
      }
    }

    // 验证目标链接的域名是否在白名单
    function checkDomain(url) {
      try {
        const urlObj = new URL(url);
        const domain = urlObj.hostname.replace(/^www\./, '');
        // 检查是否在白名单（支持二级域名）
        return ALLOWED_DOMAINS.some(allowDomain => {
          return domain === allowDomain || domain.endsWith('.' + allowDomain);
        });
      } catch (e) {
        console.log('域名验证失败：', e);
        return false;
      }
    }

    // 监听iframe标题变化（授权时同步页面标题）
    function watchIframeTitle() {
      try {
        // 定时检测iframe标题
        const titleWatcher = setInterval(() => {
          try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeTitle = iframeDoc.title;
            if (iframeTitle && iframeTitle !== 'about:blank') {
              document.title = iframeTitle;
              clearInterval(titleWatcher);
            }
          } catch (e) {
            // 跨域无法获取标题，不处理
            clearInterval(titleWatcher);
          }
        }, 500);
      } catch (e) {
        console.log('监听标题失败：', e);
      }
    }

    // 主逻辑
    function init() {
      const targetUrl = getTargetUrl();
      
      // 无有效链接 → 显示错误页
      if (!targetUrl || !targetUrl.startsWith('http')) {
        loading.style.opacity = 0;
        setTimeout(() => {
          loading.style.display = 'none';
          errorPage.style.display = 'flex';
          errorDesc.textContent = LOAD_ERROR_TEXT;
        }, 500);
        return;
      }

      // 验证域名是否在白名单
      const isAuthorized = checkDomain(targetUrl);
      
      // 设置页面标题（未授权强制自定义标题）
      if (!isAuthorized) {
        document.title = UNAUTH_TITLE;
        // 显示未授权提示框
        authTipBar.style.display = 'block';
        // iframe预留提示框高度
        iframe.classList.add('with-tip');
      }

      // 加载目标链接
      iframe.src = targetUrl;
      
      // iframe加载成功
      iframe.onload = function() {
        loading.style.opacity = 0;
        setTimeout(() => {
          loading.style.display = 'none';
          iframe.style.display = 'block';
          // 授权状态下同步iframe标题
          if (isAuthorized) {
            watchIframeTitle();
          }
        }, 500);
      };
      
      // iframe加载失败
      iframe.onerror = function() {
        loading.style.opacity = 0;
        setTimeout(() => {
          loading.style.display = 'none';
          errorPage.style.display = 'flex';
          errorDesc.textContent = LOAD_ERROR_TEXT;
        }, 500);
      };
    }

    // 启动逻辑
    init();
  </script>
</body>
</html>
